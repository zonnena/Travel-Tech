---
phase: 02-dual-axis-navigator
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - css/style.css
  - js/app.js
autonomous: true

must_haves:
  truths:
    - "User can tap/click to select a time period from a vertical list on the left side of the screen"
    - "User can tap/click to select a content category from a horizontal bar at the bottom of the screen"
    - "Changing the time period shifts the UI color theme visibly (amber for Ancient, brown for Medieval, teal for Ottoman, blue for Modern, purple/magenta for Folklore)"
    - "All transitions between selections are smooth with no jank or stutter"
    - "Current selections are stored in window.geoState and accessible by other scripts"
    - "Custom events fire when selections change so Phase 3 can listen"
  artifacts:
    - path: "index.html"
      provides: "Y-axis time period selector HTML, X-axis category selector HTML"
      contains: "time-axis"
    - path: "css/style.css"
      provides: "Navigator styling, time-period theme classes, transition animations"
      contains: "time-axis"
    - path: "js/app.js"
      provides: "Navigator interaction logic, geoState object, custom event dispatch"
      contains: "geoState"
  key_links:
    - from: "js/app.js"
      to: "css/style.css"
      via: "CSS class swap on body element for theme shifts"
      pattern: "classList.*theme-"
    - from: "js/app.js"
      to: "index.html"
      via: "querySelector for navigator elements, active class toggling"
      pattern: "querySelector.*axis"
    - from: "js/app.js"
      to: "window.geoState"
      via: "Global state object storing timePeriod and category"
      pattern: "window\\.geoState"
    - from: "js/app.js"
      to: "CustomEvent"
      via: "Dispatches 'timePeriodChange' and 'categoryChange' events on document"
      pattern: "dispatchEvent.*CustomEvent"
---

<objective>
Build the dual-axis navigator UI that lets users select a time period (Y-axis, left side) and content category (X-axis, bottom), with visible theme color shifts per time period and smooth 60fps transitions.

Purpose: This is the core interaction model for GeoLayers — every feature in Phase 3 and 4 reads from these selections.
Output: Working navigator overlay on the map with theme-shifting capability and global state for downstream phases.
</objective>

<execution_context>
@C:\Users\Admin\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Admin\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@index.html
@css/style.css
@js/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add navigator HTML and CSS (time axis + category bar + theme classes)</name>
  <files>index.html, css/style.css</files>
  <action>
**In index.html**, add TWO new UI elements between the `#map` div and the `#status-pill` div:

1. **Y-axis time period selector** (left side vertical list):
```html
<nav id="time-axis" class="time-axis">
  <button class="time-axis__item active" data-period="ancient">Ancient</button>
  <button class="time-axis__item" data-period="medieval">Medieval</button>
  <button class="time-axis__item" data-period="ottoman">Ottoman</button>
  <button class="time-axis__item" data-period="modern">Modern</button>
  <button class="time-axis__item" data-period="folklore">Folklore</button>
</nav>
```

2. **X-axis category selector** (bottom horizontal bar, ABOVE the status pill):
```html
<nav id="category-bar" class="category-bar">
  <button class="category-bar__item active" data-category="archaeology">Archaeology</button>
  <button class="category-bar__item" data-category="nature">Nature</button>
  <button class="category-bar__item" data-category="religion">Religion</button>
  <button class="category-bar__item" data-category="geology">Geology</button>
</nav>
```

**In css/style.css**, add ALL of the following:

1. **CSS custom properties for each time period theme** — add these as body class overrides. The default (Ancient) uses the existing neon-cyan. Each theme overrides `--theme-accent`, `--theme-accent-rgb`, `--theme-glow`, and `--theme-bg-tint`:

```css
/* Theme variables with transition */
:root {
  --theme-accent: #f59e0b;       /* Ancient: amber */
  --theme-accent-rgb: 245, 158, 11;
  --theme-glow: rgba(245, 158, 11, 0.4);
  --theme-bg-tint: rgba(245, 158, 11, 0.03);
}

body { transition: background-color 0.5s ease; }

body.theme-ancient {
  --theme-accent: #f59e0b;
  --theme-accent-rgb: 245, 158, 11;
  --theme-glow: rgba(245, 158, 11, 0.4);
  --theme-bg-tint: rgba(245, 158, 11, 0.03);
}
body.theme-medieval {
  --theme-accent: #a0845c;
  --theme-accent-rgb: 160, 132, 92;
  --theme-glow: rgba(160, 132, 92, 0.4);
  --theme-bg-tint: rgba(160, 132, 92, 0.03);
}
body.theme-ottoman {
  --theme-accent: #14b8a6;
  --theme-accent-rgb: 20, 184, 166;
  --theme-glow: rgba(20, 184, 166, 0.4);
  --theme-bg-tint: rgba(20, 184, 166, 0.03);
}
body.theme-modern {
  --theme-accent: #3b82f6;
  --theme-accent-rgb: 59, 130, 246;
  --theme-glow: rgba(59, 130, 246, 0.4);
  --theme-bg-tint: rgba(59, 130, 246, 0.03);
}
body.theme-folklore {
  --theme-accent: #d946ef;
  --theme-accent-rgb: 217, 70, 239;
  --theme-glow: rgba(217, 70, 239, 0.4);
  --theme-bg-tint: rgba(217, 70, 239, 0.03);
}
```

2. **Time axis styles** — fixed left side, vertical stack, glassmorphism background:
   - Position: fixed, left: 0, top: 50%, transform translateY(-50%)
   - Flex column, gap 4px, padding 8px
   - Background: rgba(18,18,26,0.85) with backdrop-filter blur
   - Border-right with theme-accent at low opacity
   - z-index: 1100 (same as header)
   - Each button: transparent bg, no border, color var(--text-secondary), padding 10px 14px, font-size 11px, font-family var(--font-body), cursor pointer, border-radius 8px, transition all 0.3s ease, text-transform uppercase, letter-spacing 0.05em, writing-mode horizontal (NOT vertical)
   - Active button: color var(--theme-accent), background rgba(var(--theme-accent-rgb), 0.12), box-shadow with theme-glow
   - Hover (non-active): color var(--text-primary), background rgba(255,255,255,0.05)

3. **Category bar styles** — fixed bottom, horizontal, above status pill:
   - Position: fixed, bottom: 54px (above status pill), left: 50%, transform translateX(-50%)
   - Flex row, gap 6px, padding 6px 10px
   - Same glassmorphism background as time axis
   - Border with theme-accent at low opacity, border-radius 16px
   - z-index: 1100
   - Each button: transparent bg, no border, color var(--text-secondary), padding 8px 16px, font-size 12px, font-family var(--font-body), cursor pointer, border-radius 12px, transition all 0.3s ease, white-space nowrap
   - Active button: color #fff, background var(--theme-accent), box-shadow 0 0 12px var(--theme-glow), font-weight 600
   - Hover (non-active): color var(--text-primary), background rgba(255,255,255,0.08)

4. **Header border update** — change the top-bar border-bottom color to use `var(--theme-accent)` at low opacity instead of the hardcoded cyan, with a transition:
   - `.top-bar { border-bottom-color: rgba(var(--theme-accent-rgb), 0.15); transition: border-bottom-color 0.5s ease; }`

5. **Responsive adjustments** for mobile (max-width: 480px):
   - Time axis: font-size 10px, padding 6px 10px per button, overall padding 6px
   - Category bar: bottom: 46px, font-size 11px, padding 6px 12px per button, gap 4px
   - Status pill: already handled in Phase 1

6. **Use `will-change: transform, opacity` on buttons** for GPU-accelerated transitions.

IMPORTANT: Do NOT duplicate the existing :root block. Add the new --theme-* variables INTO the existing :root block. Add body.theme-* classes as new rule blocks below it.
  </action>
  <verify>
Open index.html in browser. Visually confirm:
- Left side shows vertical stack of 5 time period buttons
- Bottom shows horizontal row of 4 category buttons above the status pill
- "Ancient" time period and "Archaeology" category appear highlighted/active by default
- Elements have glassmorphism backgrounds and don't obscure map usability
  </verify>
  <done>
Navigator HTML elements render correctly, styled with glassmorphism, positioned as left-side vertical and bottom horizontal overlays on the map. Theme CSS classes defined for all 5 time periods.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add navigator interaction logic, global state, and custom events</name>
  <files>js/app.js</files>
  <action>
**In js/app.js**, add the following OUTSIDE the existing IIFE (after it closes), in a NEW IIFE block:

1. **Global state object** — define BEFORE the IIFE so it's globally accessible:
```javascript
window.geoState = {
  timePeriod: 'ancient',
  category: 'archaeology',
  position: null  // Will be set by GPS code
};
```

2. **Navigator interaction IIFE:**

```javascript
(function() {
  'use strict';

  var timeAxis = document.getElementById('time-axis');
  var categoryBar = document.getElementById('category-bar');
  var body = document.body;

  // Set initial theme class
  body.classList.add('theme-ancient');

  // --- Time Period Selection ---
  timeAxis.addEventListener('click', function(e) {
    var btn = e.target.closest('.time-axis__item');
    if (!btn || btn.classList.contains('active')) return;

    // Update active button
    timeAxis.querySelector('.active').classList.remove('active');
    btn.classList.add('active');

    // Update state
    var period = btn.getAttribute('data-period');
    window.geoState.timePeriod = period;

    // Swap theme class on body
    body.className = body.className.replace(/theme-\w+/, '');
    body.classList.add('theme-' + period);

    // Dispatch custom event
    document.dispatchEvent(new CustomEvent('timePeriodChange', {
      detail: { timePeriod: period }
    }));
  });

  // --- Category Selection ---
  categoryBar.addEventListener('click', function(e) {
    var btn = e.target.closest('.category-bar__item');
    if (!btn || btn.classList.contains('active')) return;

    // Update active button
    categoryBar.querySelector('.active').classList.remove('active');
    btn.classList.add('active');

    // Update state
    var category = btn.getAttribute('data-category');
    window.geoState.category = category;

    // Dispatch custom event
    document.dispatchEvent(new CustomEvent('categoryChange', {
      detail: { category: category }
    }));
  });
})();
```

3. **Wire GPS position to geoState** — inside the EXISTING IIFE, in the `onLocationFound` function, add:
```javascript
window.geoState.position = { lat: lat, lng: lng };
```
And in the watchPosition success callback, also update:
```javascript
window.geoState.position = { lat: pos.coords.latitude, lng: pos.coords.longitude };
```

IMPORTANT NOTES:
- Define `window.geoState` at the TOP of the file, before any IIFE, so it exists when the existing GPS code runs.
- Use event delegation (single click listener on parent) for performance — already shown in the code above.
- Use `e.target.closest('.class')` for robust click targeting (handles clicks on text inside button).
- The body class swap (`theme-ancient` -> `theme-ottoman`) drives ALL visual changes through CSS custom property inheritance. No inline style changes needed.
- Ensure the existing IIFE's `map` and `L` references are not affected. The new code goes AFTER the existing IIFE.
  </action>
  <verify>
Open index.html in browser and test:
1. Click each time period button — active highlight moves, UI color theme shifts smoothly
2. Click each category button — active highlight moves with glow effect
3. Open browser console: `window.geoState` shows current selections
4. In console, run: `document.addEventListener('timePeriodChange', function(e) { console.log(e.detail); });` then click a time period — event fires with correct detail
5. Transitions are smooth (no visible jank during color shift)
  </verify>
  <done>
Clicking time periods changes the active button and smoothly shifts the entire UI color theme. Clicking categories changes the active button with glow effect. window.geoState reflects current selections. Custom events fire on every change. All transitions run at 60fps with CSS-driven animations.
  </done>
</task>

</tasks>

<verification>
1. Open index.html in a browser (or on local dev server port 5173)
2. Verify time period selector visible on left side with 5 options
3. Verify category bar visible at bottom with 4 options
4. Click each time period — confirm distinct color shift:
   - Ancient = amber/gold
   - Medieval = brown/stone
   - Ottoman = teal/turquoise
   - Modern = blue/white
   - Folklore = purple/magenta
5. Click each category — confirm active pill highlights with glow
6. Verify transitions are smooth (no flash, no jank)
7. Open console: `window.geoState` returns `{timePeriod: "...", category: "...", position: ...}`
8. Map remains fully functional (pan, zoom, GPS) with navigator overlaid
9. Test on mobile viewport (Chrome DevTools responsive mode) — navigator adapts
</verification>

<success_criteria>
- NAV-01: Y-axis time period selector works (tap/click any of 5 periods)
- NAV-02: X-axis category selector works (tap/click any of 4 categories)
- NAV-03: Each time period has a visually distinct color theme that shifts the UI
- NAV-04: All transitions are smooth CSS-driven animations (no JS-animated style changes)
- Global state (window.geoState) accessible for Phase 3
- Custom events (timePeriodChange, categoryChange) dispatched for Phase 3
</success_criteria>

<output>
After completion, create `.planning/phases/02-dual-axis-navigator/02-01-SUMMARY.md`
</output>
